<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Quran Ruku Viewer</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        height: 100vh;
    }

    /* Левая панель */
    #sidebar {
        width: 300px;
        border-right: 1px solid #ddd;
        padding: 10px;
        overflow-y: auto;
        box-sizing: border-box;
    }

    .ruku {
        padding: 10px;
        margin-bottom: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
    }

    .ruku:hover {
        background: #f5f5f5;
    }

    .tags {
        font-size: 12px;
        color: #666;
    }

    /* Правая часть */
    #content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        box-sizing: border-box;
    }

    .ayah {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
        border-bottom: 1px dashed #ddd;
        padding-bottom: 10px;
    }

    .translation {
        font-size: 16px;
    }

    .arabic {
        font-size: 22px;
        text-align: right;
        direction: rtl;
        font-family: "Amiri", serif;
    }

    select {
        width: 100%;
        margin-bottom: 10px;
        padding: 5px;
    }
</style>
<link rel="stylesheet" href="dark.css">
</head>
<body>

<div id="sidebar">
    <select id="tagFilter">
        <option value="">Все теги</option>
    </select>

    <div id="rukuList"></div>
</div>

<div id="content">
    <h2>Выберите руку‘</h2>
</div>

<script>
const sidebarItems = [
    { type: "juz", number: 1 },
    { type: "surah", number: 2, name: "Аль-Бакара" },

    {
        type: "ruku",
        id: 1,
        title: "Руку‘ 1",
        tags: ["вера"],
        chapter: 2,
        from: 1,
        to: 5
    },
    {
        type: "ruku",
        id: 2,
        title: "Руку‘ 2",
        tags: ["шариат"],
        chapter: 2,
        from: 21,
        to: 25
    }
];


const rukuList = document.getElementById("rukuList");
const tagFilter = document.getElementById("tagFilter");
const content = document.getElementById("content");

/* Заполняем теги */
const tags = [...new Set(rukuData.flatMap(r => r.tags))];
tags.forEach(tag => {
    const opt = document.createElement("option");
    opt.value = tag;
    opt.textContent = tag;
    tagFilter.appendChild(opt);
});

/* Рендер списка руку‘ */
function renderRukuList(filterTag = "") {
    rukuList.innerHTML = "";

    sidebarItems.forEach(item => {

        /* ===== Разделители ===== */
        if (item.type === "juz" && !filterTag) {
            const div = document.createElement("div");
            div.className = "divider juz";
            div.textContent = `Джуз ${item.number}`;
            rukuList.appendChild(div);
            return;
        }

        if (item.type === "surah" && !filterTag) {
            const div = document.createElement("div");
            div.className = "divider surah";
            div.textContent = `Сура ${item.number}. ${item.name}`;
            rukuList.appendChild(div);
            return;
        }

        /* ===== Руку‘ ===== */
        if (item.type === "ruku") {
            if (filterTag && !item.tags.includes(filterTag)) return;

            const div = document.createElement("div");
            div.className = "ruku";
            div.innerHTML = `
                <strong>${item.title}</strong>
                <div class="tags">#${item.tags.join(" #")}</div>
            `;
            div.onclick = () => loadRuku(item);
            rukuList.appendChild(div);
        }
    });
}


tagFilter.onchange = () => renderRukuList(tagFilter.value);

/* Загрузка текста руку‘ */
async function loadRuku(ruku) {
    content.innerHTML = `<h2>${ruku.title}</h2>`;

    const url = `https://api.quran.com/api/v4/verses/by_chapter/${ruku.chapter}?from=${ruku.from}&to=${ruku.to}&translations=45&fields=text_uthmani`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (!data.verses) {
            content.innerHTML += "<p>Ошибка загрузки аятов</p>";
            return;
        }

        data.verses.forEach(v => {
            const ayahDiv = document.createElement("div");
            ayahDiv.className = "ayah";

            ayahDiv.innerHTML = `
                <div class="translation">${v.translations[0].text}</div>
                <div class="arabic">${v.text_uthmani}</div>
            `;

            content.appendChild(ayahDiv);
        });

    } catch (e) {
        content.innerHTML += "<p>Ошибка соединения с API</p>";
        console.error(e);
    }
}

renderRukuList();
</script>

</body>
</html>
