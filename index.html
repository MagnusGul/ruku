<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Quran Ruku Viewer</title>
    <link rel="stylesheet" href="dark.css">
</head>
<body>

<div id="sidebar">

    <select id="jumpSelect">
        <option value="">Перейти к...</option>
    </select>

    <select id="tagFilter">
        <option value="">Все теги</option>
    </select>

    <div id="rukuList"></div>
</div>

<div id="content">
    <h2>Выберите руку‘</h2>
</div>

<script>
/* ================== ДАННЫЕ ================== */

const sidebarItems = [
    { type: "juz", number: 1 },
    { type: "surah", number: 1, name: "Аль-Фатиха" },
    { type: "ruku", id: 1, title: "Наилучшая молитва", tags: ["вера"], chapter: 1, from: 1, to: 7, juz: 1 },
    
    { type: "surah", number: 1, name: "Аль-Бакара" },
    { type: "ruku", id: 2, title: "1. Это руководство для богобоязненных", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1, boldSeparators: [5]  },
    { type: "ruku", id: 3, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 4, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 5, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 6, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 7, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 8, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 9, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 10, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 11, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 12, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 13, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 14, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 15, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 16, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 17, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 18, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 19, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 20, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 21, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 22, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 23, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 24, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 25, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 26, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 27, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 28, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 29, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 30, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 31, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 32, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 33, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 34, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 35, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 36, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 37, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 38, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 39, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 40, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
    { type: "ruku", id: 41, title: "", tags: ["вера"], chapter: 2, from: 1, to: 7, juz: 1 },
];

/* ================== СОСТОЯНИЕ ================== */

const rukuList = document.getElementById("rukuList");
const tagFilter = document.getElementById("tagFilter");
const jumpSelect = document.getElementById("jumpSelect");
const content = document.getElementById("content");

let activeRukuId = null;
let activeJuz = null;
let bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];

/* ================== ТЕГИ ================== */

const tags = [...new Set(
    sidebarItems
        .filter(i => i.type === "ruku")
        .flatMap(r => r.tags)
)];

tags.forEach(tag => {
    const opt = document.createElement("option");
    opt.value = tag;
    opt.textContent = tag;
    tagFilter.appendChild(opt);
});

/* ================== ПЕРЕХОД ================== */

sidebarItems.forEach(item => {
    if (item.type === "juz") {
        const opt = document.createElement("option");
        opt.value = `juz-${item.number}`;
        opt.textContent = `Джуз ${item.number}`;
        jumpSelect.appendChild(opt);
    }
    if (item.type === "surah") {
        const opt = document.createElement("option");
        opt.value = `surah-${item.number}`;
        opt.textContent = `Сура ${item.number}. ${item.name}`;
        jumpSelect.appendChild(opt);
    }
});

jumpSelect.onchange = () => {
    const target = document.querySelector(
        `[data-anchor="${jumpSelect.value}"]`
    );
    if (target) {
        target.scrollIntoView({ behavior: "smooth" });
    }
};

/* ================== РЕНДЕР ================== */

function renderRukuList(filterTag = "") {
    rukuList.innerHTML = "";

    sidebarItems.forEach(item => {

        if ((item.type === "juz" || item.type === "surah") && filterTag) return;

        if (item.type === "juz") {
            const div = document.createElement("div");
            div.className = "divider juz";
            if (item.number === activeJuz) div.classList.add("active");
            div.textContent = `Джуз ${item.number}`;
            div.dataset.anchor = `juz-${item.number}`;
            rukuList.appendChild(div);
            return;
        }

        if (item.type === "surah") {
            const div = document.createElement("div");
            div.className = "divider surah";
            div.textContent = `Сура ${item.number}. ${item.name}`;
            div.dataset.anchor = `surah-${item.number}`;
            rukuList.appendChild(div);
            return;
        }

        if (item.type === "ruku") {
            if (filterTag && !item.tags.includes(filterTag)) return;

            const div = document.createElement("div");
            div.className = "ruku";
            if (item.id === activeRukuId) div.classList.add("active");

            const star = bookmarks.includes(item.id) ? "★ " : "";

            div.innerHTML = `
                <strong>${star}${item.title}</strong>
                <div class="tags">#${item.tags.join(" #")}</div>
            `;

            div.onclick = () => loadRuku(item);
            rukuList.appendChild(div);
        }
    });
}

tagFilter.onchange = () => renderRukuList(tagFilter.value);

/* ================== ЗАГРУЗКА РУКУ‘ ================== */

async function loadRuku(ruku) {
    activeRukuId = ruku.id;
    activeJuz = ruku.juz;
    renderRukuList(tagFilter.value);

    const isBookmarked = bookmarks.includes(ruku.id);

    content.innerHTML = `
        <h2>
            ${ruku.title}
            <button id="bookmarkBtn">${isBookmarked ? "★" : "☆"}</button>
        </h2>
    `;

    document.getElementById("bookmarkBtn").onclick = () => {
        if (isBookmarked) {
            bookmarks = bookmarks.filter(id => id !== ruku.id);
        } else {
            bookmarks.push(ruku.id);
        }
        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
        loadRuku(ruku);
    };

    const url = `https://api.quran.com/api/v4/verses/by_chapter/${ruku.chapter}?from=${ruku.from}&to=${ruku.to}&translations=45&fields=text_uthmani`;

    const response = await fetch(url);
    const data = await response.json();

    data.verses.forEach(v => {
        const div = document.createElement("div");
        div.className = "ayah";
        div.innerHTML = `
            <div class="translation">${v.translations[0].text}</div>
            <div class="arabic">${v.text_uthmani}</div>
        `;
        content.appendChild(div);
    
        // жирная линия
        if (ruku.boldSeparators && ruku.boldSeparators.includes(v.verse_number)) {
            const boldLine = document.createElement("div");
            boldLine.className = "bold-separator";
            content.appendChild(boldLine);
        }
    });

}

renderRukuList();
</script>

</body>
</html>
